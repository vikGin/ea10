(function () {
    'use strict';

    // Get the WebGL context.
    const canvas = document.getElementById('canvas');
    const gl = canvas.getContext('experimental-webgl');

    // Pipeline setup.
    gl.clearColor(1, 1, 1, 1);
    // Backface culling.
    gl.frontFace(gl.CCW);
    gl.enable(gl.CULL_FACE);
    gl.cullFace(gl.BACK);
    //gl.cullFace(gl.FRONT);

    const vsSource = `
    attribute vec2 pos;
    attribute vec4 col;
    varying vec4 color;
    void main() {
        vec2 scaled = pos * 1.5;
        vec2 translated = scaled + vec2(0.2, -0.5);
        gl_Position = vec4(translated, 0, 1);
        color = col;
    }`;
    const vs = gl.createShader(gl.VERTEX_SHADER);
    gl.shaderSource(vs, vsSource);
    gl.compileShader(vs);

    // Compile fragment shader.
    const fsSouce = `
    precision mediump float;
    varying vec4 color;
    void main() {
        gl_FragColor = color;
    }`;
    const fs = gl.createShader(gl.FRAGMENT_SHADER);
    gl.shaderSource(fs, fsSouce);
    gl.compileShader(fs);

    // Link shader together into a program.
    const prog = gl.createProgram();
    gl.attachShader(prog, vs);
    gl.attachShader(prog, fs);
    gl.linkProgram(prog);
    gl.useProgram(prog);

    // Vertex data.
    const vertices = new Float32Array([-0.4444444477558136, 0.5833333134651184, -0.5555555820465088, 0.75, -0.5555555820465088, 0.5833333134651184, -0.5555555820465088, 0.4166666567325592, -0.3888888955116272, 0.4166666567325592, -0.3333333432674408, 0.5833333134651184, -0.2222222238779068, 0.4166666567325592, -0.2222222238779068, 0.5833333134651184, -0.2222222238779068, 0.75, -0.3333333432674408, 0.25, -0.4444444477558136, 0.25, -0.3888888955116272, 0.1666666716337204, -0.4444444477558136, -0.0833333358168602, -0.3888888955116272, 0.0833333358168602, -0.3333333432674408, -0.0833333358168602, -0.2777777910232544, 0.0833333358168602, -0.3333333432674408, 0.0833333358168602, -0.2222222238779068, 0.25, -0.2222222238779068, 0.0833333358168602, -0.1666666716337204, 0.25, -0.1666666716337204, 0.0833333358168602, -0.1666666716337204, 0.1666666716337204, -0.0555555559694767, 0.1666666716337204, -0.0555555559694767, 0.0833333358168602, -0.1111111119389534, -0.0833333358168602, -0.1111111119389534, 0.0833333358168602, -0.2777777910232544, 0.3333333432674408, -0.1666666716337204, 0.3333333432674408, -0.0555555559694767, 0.3333333432674408, -0.0555555559694767, 0.25, 0, 0.25, 0, 0.5, 0.1111111119389534, 0.5833333134651184, 0, 0.4166666567325592, 0.1666666716337204, 0.4166666567325592, 0.0555555559694767, 0.4166666567325592, 0, 0.3333333432674408, 0.0555555559694767, 0.3333333432674408, 0.2222222238779068, 0.5833333134651184, 0.2777777910232544, 0.75, 0.1666666716337204, 0.75, 0.2222222238779068, 0.8333333134651184, 0, -0.0833333358168602, 0.0555555559694767, 0.25, 0.1111111119389534, 0.4166666567325592]);
    // Index data.
    const colors = new Float32Array([0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.9764705896377563, 0.3333333432674408, 0.12941177189350128, 0.9764705896377563, 0.3333333432674408, 0.12941177189350128, 0.2705882489681244, 0.239215686917305, 0.23137255012989044, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.95686274766922, 0.35686275362968445, 0.1764705926179886, 0.7411764860153198, 0.6000000238418579, 0.5607843399047852, 0.9137254953384399, 0.8588235378265381, 0.8470588326454163, 0.9137254953384399, 0.8588235378265381, 0.8470588326454163, 0.9333333373069763, 0.3803921639919281, 0.2235294133424759, 0.9333333373069763, 0.3803921639919281, 0.2235294133424759, 0.9333333373069763, 0.3803921639919281, 0.2235294133424759]);
    // Index data.
    const indices = new Uint16Array([0, 1, 2, 3, 0, 4, 0, 5, 6, 4, 6, 7, 5, 5, 8, 7, 6, 6, 9, 4, 9, 10, 4, 3, 10, 9, 11, 10, 10, 12, 13, 11, 11, 10, 13, 11, 9, 13, 14, 15, 16, 9, 17, 15, 18, 17, 19, 18, 20, 19, 21, 21, 19, 22, 23, 21, 20, 24, 25, 23, 20, 24, 18, 15, 10, 12, 12, 16, 13, 9, 26, 17, 27, 19, 28, 29, 19, 22, 29, 28, 30, 22, 23, 23, 28, 31, 30, 28, 31, 32, 30, 33, 32, 34, 33, 35, 36, 34, 35, 36, 34, 37, 37, 36, 30, 35, 34, 32, 38, 38, 32, 34, 32, 38, 32, 39, 32, 40, 39, 41, 41, 39, 40, 41, 40, 32, 31, 33, 28, 36, 30, 42, 22, 23, 30, 30, 23, 42, 30, 30, 37, 42, 43, 36, 37, 44, 43]);

    // Setup vertex buffer object.
    const vbo = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
    // Bind vertex buffer to attribute variable.
    const posAttrib = gl.getAttribLocation(prog, 'pos');
    gl.vertexAttribPointer(posAttrib, 2, gl.FLOAT, false, 0, 0);
    gl.enableVertexAttribArray(posAttrib);

    // Setup color buffer object.
    const cbo = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, cbo);
    gl.bufferData(gl.ARRAY_BUFFER, colors, gl.DYNAMIC_DRAW);
    // Bind color buffer to attribute variable.
    const colAttrib = gl.getAttribLocation(prog, 'col');
    gl.vertexAttribPointer(colAttrib, 3, gl.FLOAT, false, 0, 0);
    gl.enableVertexAttribArray(colAttrib);

    // Setup index buffer object.
    const ibo = gl.createBuffer();
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);
    ibo.numerOfEmements = indices.length;

    // Clear framebuffer and render primitives.
    gl.clear(gl.COLOR_BUFFER_BIT);
    gl.drawElements(gl.TRIANGLE_STRIP, ibo.numerOfEmements, gl.UNSIGNED_SHORT, 0);

})();
