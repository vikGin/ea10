<!DOCTYPE html5>
<html>

<head>
	<script src="ext/gl-matrix.js"></script>
	<script src="GVT_Src_vertexData_torus.js"></script>
	<script src="GVT_Src_vertexData_sphere.js"></script>
	<script src="KAP_Src_tpl.js"></script>
	<script type="x-shader/x-vertex" id="vertexshader">
			attribute vec3 aPosition;
			attribute vec3 aNormal;

			uniform mat4 uPMatrix;
			uniform mat4 uMVMatrix;

			varying vec4 vColor;

			void main(){
				gl_Position = uPMatrix * uMVMatrix * vec4(aPosition, 1.0);
	
				// Prüfen ob es sich um einen Torus handelt (y-Position ist wichtig)
				// Basis-Farben: Pink für oben (y >= -0.1), Beige für unten (y < -0.1)
				vec3 baseColor;
				if (aPosition.y >= -0.1) {
					// Pink für die obere Hälfte und Mitte
					baseColor = vec3(1.0, 0.4, 0.8); // Pink
				} else {
					// Beige nur für den unteren Bereich  
					baseColor = vec3(0.9, 0.8, 0.6); // Beige
				}
				
				// Beleuchtungsintensität basierend auf der Normale
				// Normale zeigt nach außen, größere z-Komponente = näher zur Kamera
				float lightIntensity = (aNormal.z + 1.0) * 0.5; // Normalisiert auf [0,1]
				
				// Minimale Helligkeit um Details sichtbar zu halten
				lightIntensity = max(lightIntensity, 0.3);
				
				vColor = vec4(baseColor * lightIntensity, 1.0);
			}
		</script>
	<script type="x-shader/x-fragment" id="fragmentshader">
			precision mediump float;
			varying vec4 vColor;

			void main() {
				gl_FragColor = vColor;
			}
		</script>
</head>

<body>
	<div style="display: flex; gap: 20px; align-items: flex-start; font-family: Arial, sans-serif;">
		<!-- Canvas Bereich -->
		<div>
			<canvas id="canvas" width="600" height="600"></canvas>
		</div>

		<!-- Steuerelemente Bereich -->
		<div style="flex: 1; max-width: 400px;">
			<div style="padding: 15px; background: #e8f4fd; border-radius: 8px; margin-bottom: 20px;">
				<h3 style="margin-top: 0; color: #333;">Kugel-Einstellungen:</h3>
				<div style="margin: 10px 0;">
					<label style="display: block; margin-bottom: 10px; font-weight: bold;">
						Rekursionstiefe: <span id="iterationsValue">0</span>
						(Dreiecke: <span id="triangleCount">8</span>)
					</label>
					<div style="display: flex; align-items: center; gap: 15px; justify-content: center;">
						<button onclick="changeIterations(-1)" style="background: #007bff; color: white; border: none; border-radius: 5px; 
									   width: 40px; height: 40px; font-size: 18px; cursor: pointer; 
									   display: flex; align-items: center; justify-content: center;">
							-
						</button>
						<span style="font-size: 24px; font-weight: bold; min-width: 30px; text-align: center;"
							id="iterationsDisplay">0</span>
						<button onclick="changeIterations(1)" style="background: #007bff; color: white; border: none; border-radius: 5px; 
									   width: 40px; height: 40px; font-size: 18px; cursor: pointer; 
									   display: flex; align-items: center; justify-content: center;">
							+
						</button>
					</div>
					<div style="margin-top: 10px; text-align: center; font-size: 12px; color: #666;">
						Bereich: 0 bis 6 Rekursionen (begrenzt wegen 16-bit WebGL Index-Overflow)
					</div>
					<div style="margin-top: 5px; text-align: center; font-size: 11px; color: #888; font-style: italic;">
						Hinweis: Bei 7+ Rekursionen würde ein Index-Overflow auftreten<br>
						(196,608+ Vertices > 65,535 16-bit Limit)
					</div>
				</div>
			</div>

			<div style="padding: 15px; background: #fff3cd; border-radius: 8px; margin-bottom: 20px;">
				<h3 style="margin-top: 0; color: #333;">Kamera-Steuerung:</h3>
				<div style="font-size: 14px; line-height: 1.5;">
					<li><strong>↑</strong> (Pfeil nach oben): Kamera nach oben bewegen</li>
					<li><strong>↓</strong> (Pfeil nach unten): Kamera nach unten bewegen</li>
					<li><strong>←</strong> (Pfeil nach links): Kamera nach links rotieren</li>
					<li><strong>→</strong> (Pfeil nach rechts): Kamera nach rechts rotieren</li>
					<li><strong>N</strong>: Kamera wegbewegen (herauszoomen)</li>
					<li><strong>Shift+N</strong>: Kamera näherbringen (hineinzoomen)</li>
					<li><strong>Leertaste</strong>: Kamera auf Anfangsposition zurücksetzen</li>
					</ul>
				</div>
			</div>

			<div style="padding: 15px; background: #f5f5f5; border-radius: 8px;">
				<h3 style="margin-top: 0; color: #333;">Quellen:</h3>
				<p style="margin: 5px 0; font-size: 14px;">
					<strong>Kugel:</strong> Basiert auf dem Code von Paul Bourke<br>
					<a href="https://paulbourke.net/geometry/circlesphere/csource3.c" target="_blank"
						style="color: #0066cc;">
						https://paulbourke.net/geometry/circlesphere/csource3.c
					</a>
				</p>
			</div>
		</div>
	</div>

	<script>
		var currentIterations = 0;

		function updateIterations(value) {
			var iterations = parseInt(value);
			var triangles = Math.pow(4, iterations) * 8;

			document.getElementById('iterationsValue').textContent = iterations;
			document.getElementById('iterationsDisplay').textContent = iterations;
			document.getElementById('triangleCount').textContent = triangles;

			app.updateSphereIterations(iterations);
		}

		function changeIterations(delta) {
			var newIterations = currentIterations + delta;

			// Begrenze auf 0-6 Rekursionen
			if (newIterations < 0) newIterations = 0;
			if (newIterations > 6) newIterations = 6;

			if (newIterations !== currentIterations) {
				currentIterations = newIterations;
				updateIterations(currentIterations);
			}
		}

		// Initialisiere mit 0
		window.onload = function () {
			app.start();
			updateIterations(0);
		}
	</script>
</body>

</html>